<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, minimum-scale=1,initial-scale=1">
	<script src= "https://code.jquery.com/jquery-3.3.1.min.js"></script>
	<script src="https://unpkg.com/jquery.terminal/js/jquery.terminal.min.js"></script>
	<link rel="stylesheet" href="https://unpkg.com/jquery.terminal/css/jquery.terminal.min.css" />
	<style type="text/css">
		.terminal,
		span {
			--size: 1.0;
		}

		.cmd, .cmd div, .cmd span[data-text]:not(.cmd-inverted):not(.token):not(.emoji), .terminal, .terminal-output>:not(.raw) a, .terminal-output>:not(.raw) div, .terminal-output>:not(.raw) span[data-text]:not(.token):not(.inverted):not(.terminal-inverted):not(.cmd-inverted):not(.terminal-error):not(.emoji), .terminal.external [data-text] {
			background-color: #fff;
			color: var(--color,#aaa);
		}

		.web-upload-1, .web-upload-2 {
			box-shadow: 0px 0px 4px 1px #c7c7c7;
			text-align: center;
			border-radius: 10px;
			padding: 20px;
			position: fixed;
			left: 30%;
			top: 30%;
			z-index: 9999999999;
		}

		.hidden {
			display: none;
		}
		
		.affirm {
			text-align: center;
		}

		.blue {
			color: blue;
			font-weight: 700;
		}

		.cancel {
			cursor: pointer;
		}
	</style>
</head>

<body>
	<template id="greetings">
																Samaritan: A Digital Identity Solution. v0.0.1
															To begin, enter "start"; For help, enter "help"
																																
	   </template>

	<!-- document website registry upload modal -->
	<div class="web-upload-1 hidden">
		<div class="affirm">
			<p class="res"></p>
		</div>
		<h3>Add your website to the network</h3>
		<p>Please upload your website <code>profileDocument</code> to the network</p>.
		<form>
			<input type="file" class="file" accept=".jsonld" data-param="add-website">
			<!-- <button onclick="return false">Upload</button> -->
		</form>
		<br>
		<small><a onclick="hide(1)" class="cancel">cancel</a></small>
	</div>

		   <!-- document access registry upload modal -->
	<div class="web-upload-2 hidden">
		<div class="affirm">
			<p class="res"></p>
		</div>
		<h3>Add Access Config</h3>
		<p>Please upload your website's <code>accessDocument</code> to the network</p>.
		<form>
			<input type="file" class="file-1" accept=".jsonld"  data-param="add-webaccess">
			<!-- <button onclick="return false">Upload</button> -->
		</form>
		<br>
		<small><a onclick="hide(2)" class="cancel">cancel</a></small>
	</div>

	  <script>
		document.querySelector(".file").addEventListener("change", (e) => {
			sendToServer(e.target.dataset.param, e.target.className);
		}, false);

		document.querySelector(".file-1").addEventListener("change", (e) => {
			sendToServer(e.target.dataset.param, e.target.className);
		}, false);

		function sendToServer(url, clas) {
			const content = document.querySelector('.content');
			const [file] = document.querySelector(`.${clas}`).files;
			const reader = new FileReader();

			reader.addEventListener("load", () => {
				// send the result to the server
				fetch (url, {
					method: 'post',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify({
						'data':  reader.result,
					})
				})
				.then(res => {
					(async function () {
						await res.json().then(res => {
							if (url != 'add-webaccess')
								qs(".res").innerHTML = 
									`<code class="blue">${res.data.name}</code> has been added to the network. The website keys are: <br> <code class="blue">${res.data.keys}</code>`;
							else 
								qs(".res").innerHTML = `Access list for <code class="blue">${res.data.name}</code> has been added to the network`;
						});
					})();  
				});
			}, false);

			if (file) 
				reader.readAsText(file);
		}

		function hide(no) {
			document.querySelector(`.web-upload-${no}`).classList.add("hidden");
		}
		
	  </script>
	   <script src="js/cmd.js"></script>
</body>

</html>
